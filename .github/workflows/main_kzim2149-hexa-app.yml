name: AzureSpringCloud
on: push
env:
 ASC_PACKAGE_PATH: ${{ github.workspace }}
 AZURE_SUBSCRIPTION: 18ab1338-ecde-4f9a-8a44-191c1bec77da
jobs:
 deploy_to_production:
   runs-on: ubuntu-latest
   name: deploy to production with artifact

   steps:
   - uses: actions/checkout@v3
   - name: Set up JDK 17
     uses: actions/setup-java@v3
     with:
       java-version: '17'
       distribution: 'temurin'
       server-id: github
       settings-path: ${{ github.workspace }}

   - name: Build with Gradle
     uses: gradle/gradle-build-action@67421db6bd0bf253fb4bd25b31ebb98943c375e1
     with:
       arguments: build
   - name: Login via Azure CLI
     uses: azure/login@v1
     with:
       creds: ${{ secrets.SECRETS }}
   - name: deploy to production with artifact
     uses: azure/spring-cloud-deploy@v1
     with:
       azure-subscription: ${{ env.AZURE_SUBSCRIPTION }}
       action: Deploy
       service-name: kzim2149-hexa-app
       app-name: kzim2149-hexa-app
       use-staging-deployment: false
       package: ${{ env.ASC_PACKAGE_PATH }}/application/**/application0.0.1-SNAPSHOT.jar
